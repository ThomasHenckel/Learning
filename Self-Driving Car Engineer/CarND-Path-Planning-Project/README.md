# **CarND-Path-Planning-Project**
Self-Driving Car Engineer Nanodegree Program

[//]: # (Image References)
[image1]: ./images/path_planning.gif "run1"
   
This project takes sensor fusion and map data from a [simulated environment](https://github.com/udacity/self-driving-car-sim/releases/tag/T3_v1.2) , and produces waypoints that the car should follow.

![alt text][image1]

The car drives in a highway like environment and uses a finite state machine to decide what action to take, possible actions are:
- [KL] keep lane (transitions to PLC when a car is detected infront of our car)
- [PLC] Prepare for lane change (transitions to LCL or LCR whenever there the lane is free to do so, if both lanes are free the lane without cars for the longest distance infront is selected)
- [LCL] Do a lane change to the left (always transitions to KL)
- [LCR] Do a lane change right (always transitions to KL)

The safety of the car is goverened by a safety module, at the moment pretty simple, only making sure to slow down the car if it gets to close to a care driving infront of our car

When the state have selected an action to follow, the waypoints are generated by the trejectory generator. this code ensures that the waypoints the car should follow is placed so the cars motion are smoth, in respect to acceleration and steering.

The trejectory generator, starts by fitting a spline to some points on the cars desired trejectory. the first points are either the cars current location, and its location in the previous timestep, or the remaining points from the trejectory generated in the previous code itteration. this part ensures that the new spline have the same heading as the trejectory the car is following.
the next points to add is 3 point spased 30 meters appart, all in the center of the lane that the car is supposed to move.
If the state machine have just decided on a lane change, the first points on the spline will be the cars current heading of the car, and the 3 points would be in the new lane. as the location and heading is given by the first points, the spline will be a smooth transition to the new lane, finiching the lane change after 30 meters.
To avoid the situation where the same X give several Y values, the cordinates to fit the spline is rotated to fit the cars orientation befor fitting the spline.

The spacing of the waypoints controls the speed of the car, as one waypoint is consumed every 0.02 sec.
To kee the desired speed of 50mph every point need to be spaced with (0.02 * ref_val / 2.24) where ref_val is the desired speed.
knowing this we have to place the points along the spline with desired distance, and to do this we have to calculate the x and y along the spline to satisfie this.

The code simplifies this a bit by taking an x 30 meters out, and then getting the Y value from the spline.
We then calculate the absolut distance to this point, and now we can space each point on the x axis with a distance of 30/absolute distance.

In practic this calculation is more or less irelevant as we are on a highway going mostly straight only turning slightly, and the absolut distance is there for alway really close to the 30 meters.

## Running the Code.

### Build Instructions

1. Clone this repo.
2. Make a build directory: `mkdir build && cd build`
3. Compile: `cmake .. && make`
4. Run it: `./path_planning`.

Start up the simulator

### Simulator.
You can download the Term3 Simulator which contains the Path Planning Project from the [releases tab](https://github.com/udacity/self-driving-car-sim/releases/tag/T3_v1.2).  

To run the simulator on Mac/Linux, first make the binary file executable with the following command:
```shell
sudo chmod u+x {simulator_file_name}
```

---

## Dependencies

* cmake >= 3.5
  * All OSes: [click here for installation instructions](https://cmake.org/install/)
* make >= 4.1
  * Linux: make is installed by default on most Linux distros
  * Mac: [install Xcode command line tools to get make](https://developer.apple.com/xcode/features/)
  * Windows: [Click here for installation instructions](http://gnuwin32.sourceforge.net/packages/make.htm)
* gcc/g++ >= 5.4
  * Linux: gcc / g++ is installed by default on most Linux distros
  * Mac: same deal as make - [install Xcode command line tools]((https://developer.apple.com/xcode/features/)
  * Windows: recommend using [MinGW](http://www.mingw.org/)
* [uWebSockets](https://github.com/uWebSockets/uWebSockets)
  * Run either `install-mac.sh` or `install-ubuntu.sh`.
  * If you install from source, checkout to commit `e94b6e1`, i.e.
    ```
    git clone https://github.com/uWebSockets/uWebSockets 
    cd uWebSockets
    git checkout e94b6e1
    ```